import React, { useState, useEffect, useMemo } from 'react';
import { 
  Trash2, ExternalLink, Plus, BookOpen, Search, 
  FolderOpen, FileText, Edit2, Calendar, PieChart, 
  Tag, Share2, Bell, Save, X, ChevronDown, Filter 
} from 'lucide-react';
import { initializeApp } from 'firebase/app';
import { 
  getAuth, 
  signInAnonymously, 
  onAuthStateChanged,
  signInWithCustomToken
} from 'firebase/auth';
import { 
  getFirestore, 
  collection, 
  addDoc, 
  deleteDoc, 
  updateDoc,
  doc, 
  onSnapshot, 
  serverTimestamp,
  increment
} from 'firebase/firestore';

// --- Konfigurasi Firebase ---
const firebaseConfig = JSON.parse(__firebase_config);
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

const COLLECTION_NAME = 'study_archives_v2'; // Menggunakan koleksi baru untuk struktur data baru

// Helper untuk opsi dropdown
const SEMESTERS = [1, 2, 3, 4, 5, 6, 7, 8, 'Pendek'];
const ACADEMIC_YEARS = ['2022/2023', '2023/2024', '2024/2025', '2025/2026'];
const MONTHS = [
  'Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 
  'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'
];

export default function App() {
  // --- State Utama ---
  const [archives, setArchives] = useState([]);
  const [loading, setLoading] = useState(true);
  const [user, setUser] = useState(null);
  const [activeTab, setActiveTab] = useState('archives'); // 'archives', 'stats', 'calendar'
  const [showForm, setShowForm] = useState(false);

  // --- State Form (Create/Edit) ---
  const [formData, setFormData] = useState({
    id: null, // null jika mode tambah, isi string jika mode edit
    title: '',
    link: '',
    category: 'Mata Kuliah Umum',
    semester: '1',
    academicYear: '2024/2025',
    month: MONTHS[new Date().getMonth()],
    description: '',
    tags: ''
  });

  // --- State Filter ---
  const [searchTerm, setSearchTerm] = useState('');
  const [filterSemester, setFilterSemester] = useState('All');

  // 1. Auth & Data Fetching
  useEffect(() => {
    const initAuth = async () => {
      try {
        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
          await signInWithCustomToken(auth, __initial_auth_token);
        } else {
          await signInAnonymously(auth);
        }
      } catch (error) {
        console.error("Auth error:", error);
      }
    };
    initAuth();
    const unsubscribe = onAuthStateChanged(auth, setUser);
    return () => unsubscribe();
  }, []);

  useEffect(() => {
    if (!user) return;
    const archivesRef = collection(db, 'artifacts', appId, 'public', 'data', COLLECTION_NAME);
    
    // Subscribe real-time
    const unsubscribe = onSnapshot(archivesRef, (snapshot) => {
      const items = snapshot.docs.map(doc => ({
        id: doc.id,
        ...doc.data()
      }));
      // Sort by creation time desc
      items.sort((a, b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));
      setArchives(items);
      setLoading(false);
    });

    return () => unsubscribe();
  }, [user]);

  // --- Logic Form (Submit, Edit, Reset) ---
  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setFormData(prev => ({ ...prev, [name]: value }));
  };

  const resetForm = () => {
    setFormData({
      id: null,
      title: '',
      link: '',
      category: 'Mata Kuliah Umum',
      semester: '1',
      academicYear: '2024/2025',
      month: MONTHS[new Date().getMonth()],
      description: '',
      tags: ''
    });
    setShowForm(false);
  };

  const handleEditClick = (item) => {
    setFormData({
      id: item.id,
      title: item.title,
      link: item.url,
      category: item.category,
      semester: item.semester,
      academicYear: item.academicYear,
      month: item.month || MONTHS[0],
      description: item.description || '',
      tags: item.tags ? item.tags.join(', ') : ''
    });
    setShowForm(true);
    window.scrollTo({ top: 0, behavior: 'smooth' });
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!user) return;

    try {
      let formattedLink = formData.link;
      if (!/^https?:\/\//i.test(formData.link)) {
        formattedLink = 'https://' + formData.link;
      }

      const tagArray = formData.tags.split(',').map(t => t.trim()).filter(t => t);

      const payload = {
        title: formData.title,
        url: formattedLink,
        category: formData.category,
        semester: formData.semester,
        academicYear: formData.academicYear,
        month: formData.month,
        description: formData.description,
        tags: tagArray,
        updatedAt: serverTimestamp()
      };

      const collectionRef = collection(db, 'artifacts', appId, 'public', 'data', COLLECTION_NAME);

      if (formData.id) {
        // Mode Edit
        const docRef = doc(db, 'artifacts', appId, 'public', 'data', COLLECTION_NAME, formData.id);
        await updateDoc(docRef, payload);
      } else {
        // Mode Tambah Baru
        await addDoc(collectionRef, {
          ...payload,
          createdAt: serverTimestamp(),
          clickCount: 0,
          createdBy: user.uid
        });
      }
      resetForm();
    } catch (error) {
      console.error("Error saving:", error);
      alert("Gagal menyimpan data.");
    }
  };

  const handleDelete = async (id) => {
    if (window.confirm('Yakin hapus arsip ini?')) {
      try {
        await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', COLLECTION_NAME, id));
      } catch (error) {
        console.error("Error delete:", error);
      }
    }
  };

  const handleLinkClick = async (item) => {
    // Buka link
    window.open(item.url, '_blank');
    // Increment counter statistik
    try {
      const docRef = doc(db, 'artifacts', appId, 'public', 'data', COLLECTION_NAME, item.id);
      await updateDoc(docRef, {
        clickCount: increment(1)
      });
    } catch (e) {
      console.log("Tracking error", e);
    }
  };

  // --- Logic Filtering & Grouping ---
  const processedArchives = useMemo(() => {
    let result = archives;

    // Filter Search
    if (searchTerm) {
      const lower = searchTerm.toLowerCase();
      result = result.filter(item => 
        item.title.toLowerCase().includes(lower) ||
        item.category.toLowerCase().includes(lower) ||
        (item.tags && item.tags.some(t => t.toLowerCase().includes(lower)))
      );
    }

    // Filter Semester
    if (filterSemester !== 'All') {
      result = result.filter(item => String(item.semester) === String(filterSemester));
    }

    // Grouping by Semester for Display
    const grouped = {};
    result.forEach(item => {
      const key = `Semester ${item.semester}`;
      if (!grouped[key]) grouped[key] = [];
      grouped[key].push(item);
    });

    // Sort keys (Semester 1, 2, ...)
    return Object.keys(grouped).sort().reduce((obj, key) => {
      obj[key] = grouped[key];
      return obj;
    }, {});
  }, [archives, searchTerm, filterSemester]);

  // --- Statistik Helper ---
  const stats = useMemo(() => {
    const totalDocs = archives.length;
    const totalClicks = archives.reduce((acc, curr) => acc + (curr.clickCount || 0), 0);
    const byCategory = {};
    archives.forEach(a => {
      byCategory[a.category] = (byCategory[a.category] || 0) + 1;
    });
    return { totalDocs, totalClicks, byCategory };
  }, [archives]);

  // --- RENDER COMPONENTS ---

  const SidebarItem = ({ icon: Icon, label, id }) => (
    <button
      onClick={() => setActiveTab(id)}
      className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium transition-colors ${
        activeTab === id 
          ? 'bg-indigo-50 text-indigo-700' 
          : 'text-slate-600 hover:bg-slate-50 hover:text-slate-900'
      }`}
    >
      <Icon size={18} />
      {label}
    </button>
  );

  return (
    <div className="min-h-screen bg-slate-50 flex font-sans text-slate-800">
      {/* Sidebar Desktop */}
      <aside className="hidden md:flex flex-col w-64 bg-white border-r border-slate-200 fixed h-full z-20">
        <div className="p-6 border-b border-slate-100">
          <div className="flex items-center gap-2 text-indigo-600 font-bold text-xl">
            <BookOpen size={24} />
            <span>MyArsip</span>
          </div>
          <p className="text-xs text-slate-400 mt-1">Manajemen Kuliah Cerdas</p>
        </div>
        <nav className="flex-1 p-4 space-y-1">
          <SidebarItem icon={FolderOpen} label="Arsip Materi" id="archives" />
          <SidebarItem icon={PieChart} label="Dashboard Statistik" id="stats" />
          <SidebarItem icon={Calendar} label="Kalender Akademik" id="calendar" />
        </nav>
        <div className="p-4 border-t border-slate-100">
           <div className="flex items-center gap-3 px-2">
             <div className="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-700 font-bold text-xs">
               M
             </div>
             <div className="text-xs">
               <p className="font-medium text-slate-700">Mahasiswa</p>
               <p className="text-slate-400">Online</p>
             </div>
           </div>
        </div>
      </aside>

      {/* Mobile Header */}
      <div className="md:hidden fixed top-0 w-full bg-white border-b border-slate-200 z-30 px-4 py-3 flex items-center justify-between">
         <div className="flex items-center gap-2 text-indigo-600 font-bold">
            <BookOpen size={20} />
            <span>MyArsip</span>
          </div>
          <button onClick={() => setShowForm(!showForm)} className="bg-indigo-600 text-white p-2 rounded-full">
            <Plus size={18} />
          </button>
      </div>

      {/* Main Content */}
      <main className="flex-1 md:ml-64 p-4 md:p-8 mt-14 md:mt-0 pb-20 md:pb-8">
        
        {/* === VIEW: ARSIP === */}
        {activeTab === 'archives' && (
          <div className="max-w-4xl mx-auto">
            <div className="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
              <div>
                <h1 className="text-2xl font-bold text-slate-900">Arsip Materi</h1>
                <p className="text-slate-500 text-sm">Kelola semua link Google Drive kuliahmu di sini.</p>
              </div>
              <div className="flex gap-2">
                 <button 
                  onClick={() => setShowForm(true)}
                  className="hidden md:flex bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg text-sm font-medium items-center gap-2 shadow-sm transition-all"
                >
                  <Plus size={16} /> Tambah Materi
                </button>
              </div>
            </div>

            {/* Toolbar Filter */}
            <div className="bg-white p-3 rounded-xl border border-slate-200 shadow-sm mb-6 flex flex-col md:flex-row gap-3">
               <div className="relative flex-1">
                <Search size={16} className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400" />
                <input 
                  type="text" 
                  placeholder="Cari judul, kategori, atau tag..." 
                  className="w-full pl-9 pr-4 py-2 text-sm rounded-lg bg-slate-50 border border-slate-200 focus:outline-none focus:ring-2 focus:ring-indigo-100 focus:border-indigo-400 transition-all"
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                />
               </div>
               <div className="flex items-center gap-2">
                 <Filter size={16} className="text-slate-400" />
                 <select 
                    value={filterSemester}
                    onChange={(e) => setFilterSemester(e.target.value)}
                    className="text-sm bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 focus:outline-none focus:border-indigo-400"
                 >
                   <option value="All">Semua Semester</option>
                   {SEMESTERS.map(s => <option key={s} value={s}>Semester {s}</option>)}
                 </select>
               </div>
            </div>

            {/* FORM MODAL / SECTION */}
            {showForm && (
              <div className="bg-white rounded-xl border border-indigo-100 shadow-lg p-6 mb-8 relative animate-in fade-in slide-in-from-top-4">
                <button 
                  onClick={resetForm}
                  className="absolute top-4 right-4 text-slate-400 hover:text-slate-600"
                >
                  <X size={20} />
                </button>
                <h2 className="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2">
                  {formData.id ? <Edit2 size={18} className="text-indigo-600"/> : <Plus size={18} className="text-indigo-600"/>}
                  {formData.id ? 'Edit Arsip' : 'Tambah Arsip Baru'}
                </h2>
                <form onSubmit={handleSubmit} className="space-y-4">
                  {/* Grid 1: Identitas */}
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                     <div>
                        <label className="label-text">Judul Materi</label>
                        <input 
                          required name="title" value={formData.title} onChange={handleInputChange}
                          className="input-field" placeholder="Contoh: Slide Statistika Week 1" 
                        />
                     </div>
                     <div>
                        <label className="label-text">Kategori Mata Kuliah</label>
                        <input 
                          required name="category" value={formData.category} onChange={handleInputChange}
                          className="input-field" placeholder="Contoh: Algoritma" 
                        />
                     </div>
                  </div>

                  {/* Grid 2: Waktu */}
                  <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div>
                      <label className="label-text">Semester</label>
                      <select name="semester" value={formData.semester} onChange={handleInputChange} className="input-field">
                        {SEMESTERS.map(s => <option key={s} value={s}>{s}</option>)}
                      </select>
                    </div>
                    <div>
                      <label className="label-text">Tahun Ajaran</label>
                      <select name="academicYear" value={formData.academicYear} onChange={handleInputChange} className="input-field">
                        {ACADEMIC_YEARS.map(y => <option key={y} value={y}>{y}</option>)}
                      </select>
                    </div>
                    <div className="col-span-2">
                       <label className="label-text">Bulan Arsip</label>
                       <select name="month" value={formData.month} onChange={handleInputChange} className="input-field">
                          {MONTHS.map(m => <option key={m} value={m}>{m}</option>)}
                       </select>
                    </div>
                  </div>

                  {/* Link & Desc */}
                  <div>
                    <label className="label-text">Link Google Drive</label>
                    <div className="flex">
                      <span className="inline-flex items-center px-3 rounded-l-lg border border-r-0 border-slate-200 bg-slate-50 text-slate-500 text-sm">
                        https://
                      </span>
                      <input 
                        required name="link" value={formData.link} onChange={handleInputChange}
                        className="input-field rounded-l-none" placeholder="drive.google.com/..." 
                      />
                    </div>
                  </div>

                  <div>
                     <label className="label-text">Deskripsi Singkat (Opsional)</label>
                     <textarea 
                        name="description" value={formData.description} onChange={handleInputChange}
                        className="input-field h-20 resize-none" placeholder="Catatan tambahan tentang file ini..."
                     />
                  </div>

                  <div>
                     <label className="label-text">Tags (Pisahkan dengan koma)</label>
                     <div className="relative">
                        <Tag size={16} className="absolute left-3 top-3 text-slate-400" />
                        <input 
                          name="tags" value={formData.tags} onChange={handleInputChange}
                          className="input-field pl-9" placeholder="wajib, tugas, uas..." 
                        />
                     </div>
                  </div>

                  <div className="flex gap-3 pt-2">
                    <button type="button" onClick={resetForm} className="flex-1 px-4 py-2 border border-slate-200 rounded-lg text-slate-600 hover:bg-slate-50 font-medium">
                      Batal
                    </button>
                    <button type="submit" className="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-medium flex items-center justify-center gap-2 shadow-md transition-all">
                      <Save size={18} />
                      {formData.id ? 'Simpan Perubahan' : 'Simpan Arsip'}
                    </button>
                  </div>
                </form>
              </div>
            )}

            {/* LIST CONTENT */}
            {loading ? (
              <div className="text-center py-20 text-slate-400 animate-pulse">Memuat arsip Anda...</div>
            ) : Object.keys(processedArchives).length === 0 ? (
              <div className="text-center py-20 bg-white rounded-xl border border-dashed border-slate-300">
                <FolderOpen size={48} className="mx-auto text-slate-300 mb-4" />
                <h3 className="text-slate-900 font-medium">Belum ada arsip</h3>
                <p className="text-slate-500 text-sm">Silakan tambah materi baru.</p>
              </div>
            ) : (
              <div className="space-y-8">
                {Object.entries(processedArchives).map(([semester, items]) => (
                  <div key={semester}>
                    <div className="flex items-center gap-3 mb-4">
                      <h3 className="text-lg font-bold text-slate-800 bg-white px-3 py-1 rounded-lg border border-slate-200 shadow-sm inline-block">
                        {semester}
                      </h3>
                      <div className="h-px bg-slate-200 flex-1"></div>
                    </div>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      {items.map(item => (
                        <div key={item.id} className="bg-white p-5 rounded-xl border border-slate-100 shadow-sm hover:shadow-md hover:border-indigo-200 transition-all group relative">
                          
                          {/* Top: Category & Menu */}
                          <div className="flex justify-between items-start mb-3">
                            <span className="text-[10px] font-bold uppercase tracking-wider text-indigo-600 bg-indigo-50 px-2 py-1 rounded-md">
                              {item.category}
                            </span>
                            <div className="flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                              <button onClick={() => handleEditClick(item)} className="p-1.5 text-slate-400 hover:text-indigo-600 rounded bg-slate-50 hover:bg-indigo-50">
                                <Edit2 size={14} />
                              </button>
                              <button onClick={() => handleDelete(item.id)} className="p-1.5 text-slate-400 hover:text-red-600 rounded bg-slate-50 hover:bg-red-50">
                                <Trash2 size={14} />
                              </button>
                            </div>
                          </div>

                          {/* Middle: Title & Meta */}
                          <h4 className="font-semibold text-slate-800 mb-1 leading-snug">{item.title}</h4>
                          <div className="text-xs text-slate-500 flex flex-wrap gap-x-3 gap-y-1 mb-3">
                            <span>{item.academicYear}</span>
                            <span>•</span>
                            <span>{item.month}</span>
                            {item.clickCount > 0 && (
                               <>
                                <span>•</span>
                                <span className="text-green-600 font-medium">{item.clickCount}x diakses</span>
                               </>
                            )}
                          </div>
                          
                          {item.description && (
                            <p className="text-sm text-slate-600 mb-4 line-clamp-2 leading-relaxed bg-slate-50 p-2 rounded-lg border border-slate-100">
                              {item.description}
                            </p>
                          )}

                          {/* Tags */}
                          {item.tags && item.tags.length > 0 && (
                            <div className="flex flex-wrap gap-1.5 mb-4">
                              {item.tags.map((tag, idx) => (
                                <span key={idx} className="text-[10px] text-slate-500 bg-slate-100 px-2 py-0.5 rounded-full border border-slate-200">
                                  #{tag}
                                </span>
                              ))}
                            </div>
                          )}

                          {/* Bottom: Action */}
                          <button 
                            onClick={() => handleLinkClick(item)}
                            className="w-full mt-auto flex items-center justify-center gap-2 bg-slate-900 hover:bg-indigo-600 text-white py-2.5 rounded-lg text-sm font-medium transition-colors"
                          >
                            Buka Materi <ExternalLink size={14} />
                          </button>
                        </div>
                      ))}
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>
        )}

        {/* === VIEW: STATISTIK === */}
        {activeTab === 'stats' && (
          <div className="max-w-4xl mx-auto animate-in fade-in">
             <h1 className="text-2xl font-bold text-slate-900 mb-6">Dashboard Statistik</h1>
             
             {/* Summary Cards */}
             <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
               <div className="bg-white p-4 rounded-xl shadow-sm border border-slate-100">
                 <p className="text-xs text-slate-500 mb-1">Total Arsip</p>
                 <p className="text-2xl font-bold text-indigo-600">{stats.totalDocs}</p>
               </div>
               <div className="bg-white p-4 rounded-xl shadow-sm border border-slate-100">
                 <p className="text-xs text-slate-500 mb-1">Total Akses</p>
                 <p className="text-2xl font-bold text-green-600">{stats.totalClicks}</p>
               </div>
                <div className="bg-white p-4 rounded-xl shadow-sm border border-slate-100">
                 <p className="text-xs text-slate-500 mb-1">Kategori Unik</p>
                 <p className="text-2xl font-bold text-orange-600">{Object.keys(stats.byCategory).length}</p>
               </div>
               <div className="bg-white p-4 rounded-xl shadow-sm border border-slate-100">
                 <p className="text-xs text-slate-500 mb-1">Backup Status</p>
                 <div className="flex items-center gap-1 text-xs font-bold text-blue-600 mt-1">
                    Auto-saved <span className="w-2 h-2 bg-blue-500 rounded-full animate-pulse"></span>
                 </div>
               </div>
             </div>

             {/* Distribution */}
             <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100 mb-8">
               <h3 className="font-bold text-slate-800 mb-4">Distribusi Materi per Kategori</h3>
               <div className="space-y-3">
                 {Object.entries(stats.byCategory).map(([cat, count]) => (
                   <div key={cat}>
                     <div className="flex justify-between text-sm mb-1">
                       <span className="text-slate-600">{cat}</span>
                       <span className="font-medium">{count} file</span>
                     </div>
                     <div className="w-full bg-slate-100 rounded-full h-2.5 overflow-hidden">
                       <div 
                        className="bg-indigo-500 h-2.5 rounded-full" 
                        style={{ width: `${(count / stats.totalDocs) * 100}%` }}
                      ></div>
                     </div>
                   </div>
                 ))}
                 {stats.totalDocs === 0 && <p className="text-sm text-slate-400 italic">Belum ada data statistik.</p>}
               </div>
             </div>

             {/* Mock Notifications for Update */}
             <div className="bg-indigo-900 text-white p-6 rounded-xl shadow-md overflow-hidden relative">
                <Bell className="absolute -top-4 -right-4 text-indigo-800 w-32 h-32 opacity-50" />
                <h3 className="font-bold text-lg mb-2 relative z-10">Pusat Notifikasi</h3>
                <p className="text-indigo-200 text-sm mb-4 relative z-10 max-w-md">
                   Sistem mendeteksi 3 link yang jarang diakses dalam 6 bulan terakhir. Pertimbangkan untuk mengarsipkan atau menghapus.
                </p>
                <button className="bg-white text-indigo-900 px-4 py-2 rounded-lg text-sm font-bold relative z-10 hover:bg-indigo-50 transition-colors">
                  Cek Rekomendasi
                </button>
             </div>
          </div>
        )}

        {/* === VIEW: KALENDER (MOCK) === */}
        {activeTab === 'calendar' && (
           <div className="max-w-4xl mx-auto animate-in fade-in">
              <h1 className="text-2xl font-bold text-slate-900 mb-6">Kalender Akademik</h1>
              <div className="bg-white border border-slate-200 rounded-xl p-8 text-center">
                 <Calendar className="mx-auto text-indigo-200 mb-4 w-16 h-16" />
                 <h3 className="text-lg font-bold text-slate-700">Integrasi Jadwal Segera Hadir</h3>
                 <p className="text-slate-500 max-w-md mx-auto mt-2">
                   Fitur ini akan memetakan materi arsip Anda dengan tanggal ujian dan tenggat waktu tugas berdasarkan silabus akademik.
                 </p>
                 <div className="mt-8 grid grid-cols-1 md:grid-cols-3 gap-4 text-left opacity-60 pointer-events-none select-none">
                    {[1,2,3].map(i => (
                      <div key={i} className="border border-slate-100 p-4 rounded-lg">
                        <div className="w-8 h-8 bg-indigo-50 rounded mb-2"></div>
                        <div className="h-2 w-3/4 bg-slate-100 rounded mb-1"></div>
                        <div className="h-2 w-1/2 bg-slate-100 rounded"></div>
                      </div>
                    ))}
                 </div>
              </div>
           </div>
        )}

      </main>

      {/* Mobile Navigation */}
      <nav className="md:hidden fixed bottom-0 w-full bg-white border-t border-slate-200 flex justify-around p-3 z-30 pb-safe">
         <button onClick={() => setActiveTab('archives')} className={`flex flex-col items-center gap-1 text-[10px] ${activeTab === 'archives' ? 'text-indigo-600 font-bold' : 'text-slate-400'}`}>
           <FolderOpen size={20} /> Arsip
         </button>
         <button onClick={() => setActiveTab('stats')} className={`flex flex-col items-center gap-1 text-[10px] ${activeTab === 'stats' ? 'text-indigo-600 font-bold' : 'text-slate-400'}`}>
           <PieChart size={20} /> Statistik
         </button>
         <button onClick={() => setActiveTab('calendar')} className={`flex flex-col items-center gap-1 text-[10px] ${activeTab === 'calendar' ? 'text-indigo-600 font-bold' : 'text-slate-400'}`}>
           <Calendar size={20} /> Kalender
         </button>
      </nav>

      {/* Styles for Tailwind Input Reusability */}
      <style>{`
        .label-text {
          @apply block text-xs font-bold text-slate-500 mb-1.5 uppercase tracking-wide;
        }
        .input-field {
          @apply w-full px-4 py-2.5 rounded-lg bg-white border border-slate-200 text-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-100 outline-none transition-all placeholder:text-slate-400 text-slate-700;
        }
        .pb-safe {
          padding-bottom: env(safe-area-inset-bottom, 20px);
        }
      `}</style>
    </div>
  );
}
